<%inherit file="../base.html"/>
<%block name="content">
    <div class="king-content-wrap">
        <div class="king-layout1-content" style="margin-left: 216px;">
            <div class="king-tab tab-box ">
                <ul id="myTab2" class="nav nav-tabs king-nav-tabs1 king-tab-info">
                    <li class="active"> <a data-toggle="tab" href="#demo1" aria-expanded="true">查询结果</a> </li>
                    <li class=""> <a data-toggle="tab" href="#demo2" aria-expanded="false">已发版</a> </li>
                    <li class=""> <a data-toggle="tab" href="#demo3" aria-expanded="false">未发版</a> </li>
                </ul>
                <div class="tab-content ">
                    <div class="tab-pane fade active in" id="demo1" style="">
                        <div class="panel panel-default mb0">
                            <div class="panel-heading">
                                <button type="button" class="king-btn mr10 king-success" id="newversion">发版</button>
                            </div>
                            <div class="panel-body">
                                <table id="code_1527301039797" class="table mb0 pr15 ranger-box ">
                                    <thead>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                                <!-- 设置面板Start -->
                                <template id="header_tpl_1527301039797">
                                    <tr>
                                        <th style="width: 100px;">#index#</th>
                                        <th style="width: 20%;">#task#</th>
                                        <th style="width: 20%;">#progress#</th>
                                        <th style="width: 20%;">#host#</th>
                                        <th>#date#</th>
                                        <th>选择菜单版本</th>
                                    </tr>
                                </template>
                                <template id="tpl_1527301039797">
                                    <tr>
                                        <td style="width: 100px;">#index#</td>
                                        <td style="width: 20%;">#columnName1#</td>
                                        <td style="width: 20%;">#columnName2#</td>
                                        <td style="width: 20%;">#columnName3#</td>
                                        <td>#columnName4#</td>
                                        <td><select>
                                            <option>1</option>
                                            <option>12</option>
                                        </select></td>
                                    </tr>
                                </template>
                                <!-- 设置面板End -->
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="demo2" style=""> </div>
                    <div class="tab-pane fade" id="demo3" style=""> </div>
                </div>
            </div>
        </div>
    </div>

            <!-- content end -->
    <script>
        content_html = "    <div class=\"king-page-box\">\n" +
            "        <div class=\"king-container clearfix\">\n" +
            "            <form class=\"form-horizontal\">\n" +
            "                <div class=\"form-group has-feedback clearfix \">\n" +
            "                    <label class=\"control-label col-sm-2 pt0\" for=\"introduction\">门店ID：</label>\n" +
            "                    <div class=\"col-sm-10\">\n" +
            "                        <textarea id=\"store_ids\" class=\"form-control\" rows=\"6\" placeholder=\"填入以逗号分隔的6位数字\"></textarea>\n" +
            "                    </div>\n" +
            "                </div>\n" +
            "            </form>\n" +
            "        </div>\n" +
            "    </div>"
        var d = dialog({
        width: 600,
        title: '填入门店ID',
        cancel: function (){},
        ok: function() {
            store_id_array = $('#store_ids').val().split(',')
            if(store_id_array == ""){
                errorAlert("门店ID不能为空")
                return
            }else if(!myutils.isArrayItemNo(store_id_array)){
                errorAlert("非正常门店ID，门店ID必须是1个或多个6位数字，并且以英文逗号分隔。")
                return
            }
            ##  window.location.href=site_url + 'test_application/new_version?store_ids=' + store_id_array
            function renderTpl(str, cfg) {
                var re = /(#(.+?)#)/g;

                return str.replace(re, function() {
                    var val = cfg[arguments[2]]+'';
                    if(typeof val == 'undefined') {
                        val = '';
                    }
                    return val;
                });
            }

            // 异步请求后台数据
            $.ajax({
                url: site_url + 'check_storeids',
                data: {data: store_id_array},
                type: 'GET',
                success: function(res){
                    var _html = ' ';
                    var list = res.items;
                    var tpl = $('#tpl_1527301039797').html();
                    var headerTpl =  $('#header_tpl_1527301039797').html();
                    for (var i=0,len=list.length; i < len; i++){
                        var item = list[i];
                        _html += renderTpl(tpl, item)
                    }
                    ## 填入内容
                    $('#code_1527301039797 tbody').html(_html);
                    ## 填入头部
                    $('#code_1527301039797 thead').html(renderTpl(headerTpl,res.catalogues));

                    ## 发版操作
                    var okList = new Array()
                    var failList = new Array()
                    $('#newversion').click(function () {
                        for(var i=0, len=list.length; i< len; i++){
                            debugger
                            var item = list[i];
                            if(item['isOk'] == 1){
                                okList.push(item)
                            }else{
                                failList.push(item)
                            }
                        }
                    })

                }
            });
        },
        okValue: '检查',
        content: content_html,
        cancelValue: '取消',
        cancel: function() {

        }
        });
        d.show();
    </script>
    <script>
    $(function(){

        });
    </script>
</%block>
